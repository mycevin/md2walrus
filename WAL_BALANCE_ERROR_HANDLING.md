# WAL 代币余额错误处理改进

## 问题描述

用户遇到了以下错误：
```
保存失败: Not enough coins of type 0x8270feb7375eee355e64fdb69c50abb6b5f9393a722883c1cf45f8e26048810a::wal::WAL to satisfy requested balance
```

这个错误信息表明用户没有足够的 WAL 代币来支付保存费用，但错误信息没有明确显示需要多少 WAL 代币。

## 解决方案

### 1. 改进错误解析

在 `useWalrusSave.ts` 中添加了 `parseWalrusError` 函数，能够：

- 检测 WAL 代币余额不足错误
- 从错误信息中提取需要的具体数量
- 将原始单位转换为可读的 WAL 单位
- 提供友好的错误信息

### 2. 添加余额检查功能

新增了以下功能：

- `checkWalBalance()`: 检查当前账户的 WAL 代币余额
- `estimateSaveCost()`: 估算保存文件所需的 WAL 代币数量
- 实时显示余额和估算费用

### 3. 改进用户界面

在 `SaveStatus.tsx` 中：

- 当遇到 WAL 代币余额不足错误时，显示特殊的错误信息
- 提供获取 WAL 代币的链接（水龙头）
- 添加了专门的错误详情区域

### 4. 错误信息格式

支持多种错误信息格式的解析：

```javascript
const patterns = [
  /requested balance[^0-9]*([0-9]+)/i,
  /balance[^0-9]*([0-9]+)/i,
  /to satisfy[^0-9]*([0-9]+)/i,
  /needed[^0-9]*([0-9]+)/i,
  /required[^0-9]*([0-9]+)/i,
  /([0-9]+)[^0-9]*balance/i
];
```

### 5. 用户友好的错误信息

现在当遇到余额不足错误时，用户会看到：

```
WAL代币余额不足。需要: X WAL
```

而不是原始的复杂错误信息。

### 6. 获取 WAL 代币的指导

在错误详情中提供了获取 WAL 代币的链接：

- 🚰 Walrus 测试网水龙头
- 🚰 Sui 测试网水龙头

## 使用方法

1. **检查余额**: 点击"检查 WAL 余额"按钮查看当前余额
2. **估算费用**: 点击"估算保存费用"按钮查看预计需要的 WAL 代币
3. **获取代币**: 如果余额不足，点击错误详情中的水龙头链接获取测试代币

## 技术细节

### WAL 代币类型
```javascript
const WAL_COIN_TYPE = "0x8270feb7375eee355e64fdb69c50abb6b5f9393a722883c1cf45f8e26048810a::wal::WAL";
```

### 单位转换
- 原始单位：MIST (最小单位)
- 显示单位：WAL
- 转换比例：1 WAL = 1,000,000,000 MIST

### 成本估算
基于文件大小进行粗略估算：
- 每 KB 约需要 1 WAL
- 实际费用可能因网络状况而异

## 测试建议

1. 使用没有 WAL 代币的账户尝试保存
2. 验证错误信息是否正确显示需要的 WAL 数量
3. 测试余额检查和成本估算功能
4. 验证水龙头链接是否正常工作

## 后续改进

1. 实现更精确的成本估算算法
2. 添加自动获取测试代币的功能
3. 支持主网和测试网的切换
4. 添加余额不足时的自动提醒
